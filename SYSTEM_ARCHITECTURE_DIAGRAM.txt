╔══════════════════════════════════════════════════════════════════════════════════╗
║                     SMART WALKING STICK - SYSTEM ARCHITECTURE                     ║
╚══════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           HARDWARE LAYER (Walking Stick)                         │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────────────────────────┐
                    │         ESP32-S3 DevKit               │
                    │  ┌─────────────────────────────────┐  │
                    │  │   Dual-Core Xtensa LX7 @ 240MHz│  │
                    │  │   512KB RAM, 4MB Flash         │  │
                    │  │   Bluetooth 5.0 LE + WiFi      │  │
                    │  └─────────────────────────────────┘  │
                    └───────────────────────────────────────┘
                              │           │
              ┌───────────────┴───────┐   └───────────────┬───────────────┐
              │                       │                   │               │
              ▼                       ▼                   ▼               ▼
    ┌─────────────────┐    ┌─────────────────┐  ┌────────────────┐  ┌──────────┐
    │   I²C BUS       │    │   SPI BUS       │  │  GPIO Pins     │  │  ADC     │
    │  (GPIO 8,9)     │    │  (GPIO 11-14)   │  │  (1,2,3,15)    │  │ (GPIO 4) │
    └─────────────────┘    └─────────────────┘  └────────────────┘  └──────────┘
              │                       │                   │               │
      ┌───────┴───────┐              │          ┌────────┴──────┐        │
      ▼               ▼              ▼          ▼               ▼        ▼
┌──────────┐   ┌──────────┐   ┌──────────┐  ┌─────┐  ┌───────────┐  ┌─────────┐
│ MPU6050  │   │ VL53L1X  │   │ MFRC522  │  │ SOS │  │  Buzzer   │  │ Battery │
│   IMU    │   │   ToF    │   │   RFID   │  │ Btn │  │ Vib+LED   │  │  Sense  │
└──────────┘   └──────────┘   └──────────┘  └─────┘  └───────────┘  └─────────┘
    │               │               │           │          │              │
    │               │               │           │          │              │
    ▼               ▼               ▼           ▼          ▼              ▼
[Accel/Gyro]  [Distance 0-4m] [RFID Tags]  [Emergency] [Haptic]   [Voltage %]


┌─────────────────────────────────────────────────────────────────────────────────┐
│                          FIRMWARE LAYER (ESP32-S3)                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────────────────────────────┐
    │                            main.cpp                                       │
    │  ┌────────────────────────────────────────────────────────────────────┐  │
    │  │  setup()  │  loop()  │  event handlers  │  state management       │  │
    │  └────────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────────┘
                 │                │                │                │
         ┌───────┴────┐    ┌──────┴─────┐   ┌─────┴──────┐   ┌────┴─────┐
         ▼            ▼    ▼            ▼   ▼            ▼   ▼          ▼
    ┌─────────┐  ┌────────┐  ┌──────────┐  ┌──────┐  ┌─────────┐  ┌────────┐
    │sensors  │  │  fall  │  │   ble    │  │haptic│  │ config  │  │  pins  │
    │  .cpp   │  │detect  │  │  .cpp    │  │ .cpp │  │  .h     │  │  .h    │
    └─────────┘  └────────┘  └──────────┘  └──────┘  └─────────┘  └────────┘
         │            │            │            │
         │            │            │            │
    ┌────┴─────────┐  │            │       ┌────┴─────────┐
    │ imu_read()   │  │            │       │ buzzer_pwm() │
    │ tof_read()   │  │            │       │ led_set()    │
    │ rfid_read()  │  │            │       │ vibrate()    │
    │ battery_read │  │            │       └──────────────┘
    └──────────────┘  │            │
                      │            │
              ┌───────┴────────┐   │
              │ Algorithm:     │   │
              │ 1. Spike >3.2g │   │
              │ 2. Stillness   │   │
              │ 3. Alert       │   │
              └────────────────┘   │
                                   │
                        ┌──────────┴──────────────┐
                        │  NimBLE Stack           │
                        │  ┌──────────────────┐   │
                        │  │ GATT Service     │   │
                        │  │ - Sensor Data    │   │
                        │  │ - Alerts         │   │
                        │  │ - Config         │   │
                        │  └──────────────────┘   │
                        └─────────────────────────┘
                                   │
                                   │ BLE Radio
                                   ▼


┌─────────────────────────────────────────────────────────────────────────────────┐
│                      COMMUNICATION LAYER (Wireless)                              │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌──────────────────────────────────┐
                    │    Bluetooth Low Energy (BLE)    │
                    │                                  │
                    │  Service: 12345678-...-890ab     │
                    │                                  │
                    │  Characteristics:                │
                    │  • Sensor Data (notify)          │
                    │    └─→ JSON: {imu, dist, batt}   │
                    │  • Alerts (notify)               │
                    │    └─→ JSON: {event, data}       │
                    │  • Config (read/write)           │
                    │    └─→ JSON: {thresholds, freq}  │
                    └──────────────────────────────────┘
                                   │
                    ┌──────────────┴───────────────┐
                    │                              │
                    ▼                              ▼
            [Physical Device]              [Simulator Mode]
             (Hardware Mode)                (WebSocket)
                    │                              │
                    │                              │
                    ▼                              ▼


┌─────────────────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER (Web Dashboard)                          │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────────────────────────────┐
    │                         WEB BROWSER (Chrome/Edge)                         │
    │  ┌────────────────────────────────────────────────────────────────────┐  │
    │  │                    React 18 + Vite Application                     │  │
    │  │                                                                    │  │
    │  │  ┌──────────────────┐         ┌─────────────────────────────┐     │  │
    │  │  │   App.jsx        │         │   Services Layer            │     │  │
    │  │  │                  │────────▶│  • bluetooth.js (Web BLE)   │     │  │
    │  │  │  State:          │         │  • websocket (Simulator)    │     │  │
    │  │  │  - mode          │         └─────────────────────────────┘     │  │
    │  │  │  - connected     │                                             │  │
    │  │  │  - sensorData    │         ┌─────────────────────────────┐     │  │
    │  │  │  - alerts[]      │         │   Hooks Layer               │     │  │
    │  │  └──────────────────┘         │  • useSmartStick.js         │     │  │
    │  │          │                    │    - connect()              │     │  │
    │  │          │                    │    - disconnect()           │     │  │
    │  │          ▼                    │    - updateConfig()         │     │  │
    │  │  ┌──────────────────┐         │    - switchMode()           │     │  │
    │  │  │  Dashboard.jsx   │         └─────────────────────────────┘     │  │
    │  │  │                  │                                             │  │
    │  │  │  Components:     │         ┌─────────────────────────────┐     │  │
    │  │  │  ┌────────────┐  │         │   UI Components             │     │  │
    │  │  │  │ Header Bar │  │         │  • Sensor Cards             │     │  │
    │  │  │  │ Mode Toggle│  │         │  • IMU Chart (Recharts)     │     │  │
    │  │  │  │ Connect Btn│  │         │  • Alert History Panel      │     │  │
    │  │  │  └────────────┘  │         │  • Config Modal             │     │  │
    │  │  │  ┌────────────┐  │         │  • Toast Notifications      │     │  │
    │  │  │  │Sensor Grid │  │         └─────────────────────────────┘     │  │
    │  │  │  │ • IMU      │  │                                             │  │
    │  │  │  │ • Gyro     │  │         ┌─────────────────────────────┐     │  │
    │  │  │  │ • Distance │  │         │   Styling                   │     │  │
    │  │  │  │ • Battery  │  │         │  • Tailwind CSS             │     │  │
    │  │  │  │ • RFID     │  │         │  • Responsive Design        │     │  │
    │  │  │  └────────────┘  │         │  • Dark Theme               │     │  │
    │  │  │  ┌────────────┐  │         └─────────────────────────────┘     │  │
    │  │  │  │Live Charts │  │                                             │  │
    │  │  │  │ (History)  │  │                                             │  │
    │  │  │  └────────────┘  │                                             │  │
    │  │  │  ┌────────────┐  │                                             │  │
    │  │  │  │Alert Panel │  │                                             │  │
    │  │  │  │ • SOS 🔴   │  │                                             │  │
    │  │  │  │ • Fall 🟠  │  │                                             │  │
    │  │  │  │ • Obst 🟡  │  │                                             │  │
    │  │  │  │ • RFID 🟢  │  │                                             │  │
    │  │  │  └────────────┘  │                                             │  │
    │  │  └──────────────────┘                                             │  │
    │  └────────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────┐
│                    DEVELOPMENT/TESTING LAYER (Simulator)                         │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────────────────────────────────────────────────────────┐
    │                      Node.js Backend (Port 3001)                          │
    │  ┌────────────────────────────────────────────────────────────────────┐  │
    │  │  server.js                                                         │  │
    │  │  ┌──────────────────────────────────────────────────────────────┐  │  │
    │  │  │  Express + WebSocket Server                                  │  │  │
    │  │  │  • ws://localhost:3001                                       │  │  │
    │  │  │  • Connection handling                                       │  │  │
    │  │  │  • Message routing                                           │  │  │
    │  │  └──────────────────────────────────────────────────────────────┘  │  │
    │  │                              │                                     │  │
    │  │                              ▼                                     │  │
    │  │  ┌──────────────────────────────────────────────────────────────┐  │  │
    │  │  │  simulator.js                                                │  │  │
    │  │  │  ┌────────────────────────────────────────────────────────┐  │  │  │
    │  │  │  │  Sensor Data Generation                                │  │  │  │
    │  │  │  │  • IMU: Walking pattern simulation                     │  │  │  │
    │  │  │  │  • ToF: Random obstacle detection (50% prob)           │  │  │  │
    │  │  │  │  • Battery: Slow discharge simulation                  │  │  │  │
    │  │  │  │  • RFID: Periodic tag scans                            │  │  │  │
    │  │  │  └────────────────────────────────────────────────────────┘  │  │  │
    │  │  │  ┌────────────────────────────────────────────────────────┐  │  │  │
    │  │  │  │  Alert Generation (Random Events)                      │  │  │  │
    │  │  │  │  • Fall Detection: ~1% per second                      │  │  │  │
    │  │  │  │  • Obstacle Alerts: 15% per second                     │  │  │  │
    │  │  │  │  • RFID Scans: Periodic                                │  │  │  │
    │  │  │  │  • SOS: Manual trigger                                 │  │  │  │
    │  │  │  └────────────────────────────────────────────────────────┘  │  │  │
    │  │  │  ┌────────────────────────────────────────────────────────┐  │  │  │
    │  │  │  │  Config Management                                     │  │  │  │
    │  │  │  │  • Store thresholds                                    │  │  │  │
    │  │  │  │  • Update frequencies                                  │  │  │  │
    │  │  │  └────────────────────────────────────────────────────────┘  │  │  │
    │  │  └──────────────────────────────────────────────────────────────┘  │  │
    │  └────────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════════

                              DATA FLOW DIAGRAM

ESP32 Device                      Web Dashboard                    Simulator
─────────────                     ──────────────                   ──────────

[Sensors] ──┐                                                    [Generator]
            │ Read                                                     │
            ▼                                                          │
[Process]   │ Algorithm                                                │
            │ • Fall detect                                            │
            │ • Threshold                                              │
            ▼                                                          │
[Serialize] │ JSON                                                     │
            │ format                                                   │
            ▼                                                          ▼
[BLE GATT]  │ Notify ──────────▶ [Web BLE API] ◀────── WebSocket ─── [Socket]
            │                           │                              │
            │                           ▼                              │
            │                    [State Update]                        │
            │                           │                              │
            │                           ▼                              │
            │                    [React Render]                        │
            │                           │                              │
            │                           ├──▶ [Sensor Cards]            │
            │                           ├──▶ [Live Charts]             │
            │                           └──▶ [Alert Panel]             │
            │                                                          │
[Config] ◀──┴───────── Write ──── [Config Modal] ──── getConfig ──────┘
 Update                                                             Response


═══════════════════════════════════════════════════════════════════════════════════

                        DEPLOYMENT ARCHITECTURE

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              PRODUCTION SETUP                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

    USER'S SMARTPHONE/TABLET                    WALKING STICK DEVICE
    ┌──────────────────────┐                   ┌──────────────────┐
    │  Mobile Browser      │                   │   ESP32-S3       │
    │  (Chrome/Edge)       │ ◀── BLE 5.0 LE ──▶│   + Sensors      │
    │                      │                   │   + Battery      │
    │  • Dashboard UI      │    < 10m range    │                  │
    │  • Real-time data    │                   │  • Autonomous    │
    │  • Alerts display    │                   │  • Low power     │
    │  • Configuration     │                   │  • Portable      │
    └──────────────────────┘                   └──────────────────┘
            │                                            │
            │                                            │
            └────────────────┬───────────────────────────┘
                             │
                             ▼
                    [Optional: Cloud Storage]
                    • Alert history backup
                    • Analytics dashboard
                    • Multi-device sync
                    • Emergency contacts


═══════════════════════════════════════════════════════════════════════════════════
